================================================================================
    CogX Backend API - Next.js Frontend Development Guide
================================================================================

Project: CogX - Cognitive Games Platform
Backend: ASP.NET Core (.NET 10) with SignalR
Target Framework: Next.js (React)
Last Updated: 2024

================================================================================
TABLE OF CONTENTS
================================================================================

1. Project Overview
2. Backend Architecture
3. API Base URL Configuration
4. Required Dependencies
5. REST API Endpoints Reference
6. SignalR WebSocket Integration
7. Data Models (DTOs)
8. Complete Implementation Examples
9. Testing the Backend
10. Common Issues & Troubleshooting
11. Environment Setup Checklist

================================================================================
1. PROJECT OVERVIEW
================================================================================

CogX is a multiplayer cognitive games platform supporting:
- Tic-Tac-Toe (Morpion)
- Speed Typing
- Connect 4 (Puissance4)

The backend provides:
- REST API for game management (lobbies, players, leaderboard)
- SignalR WebSocket Hubs for real-time gameplay
- SQL Server database for persistence
- CORS enabled for local development

================================================================================
2. BACKEND ARCHITECTURE
================================================================================

Technology Stack:
- Framework: ASP.NET Core (.NET 10)
- Database: SQL Server (LocalDB)
- Real-time: SignalR
- ORM: Entity Framework Core

Port Configuration:
- HTTPS: https://localhost:7049
- HTTP: http://localhost:5000 (if configured)

CORS Policy:
- Name: "DevelopmentCorsPolicy"
- Currently accepts ALL origins in development
- Allows credentials (required for SignalR)
- ?? WARNING: Must be restricted in production!

Database:
- Connection: Server=(localdb)\mssqllocaldb;Database=CogXDb
- Migrations: Applied automatically
- Provider: SQL Server

================================================================================
3. API BASE URL CONFIGURATION
================================================================================

Create environment variables in Next.js:

--- .env.local ---
NEXT_PUBLIC_API_URL=https://localhost:7049
NEXT_PUBLIC_WS_URL=wss://localhost:7049
------------------

Usage in code:
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL;
const WS_BASE_URL = process.env.NEXT_PUBLIC_WS_URL;

Example API call:
fetch(`${API_BASE_URL}/api/player`)

Example WebSocket connection:
new HubConnectionBuilder()
  .withUrl(`${WS_BASE_URL}/lobbyhub`)

================================================================================
4. REQUIRED DEPENDENCIES
================================================================================

Install these npm packages:

--- Core Dependencies ---
npm install @microsoft/signalr axios

--- TypeScript Support (Recommended) ---
npm install --save-dev @types/node

--- Optional (State Management) ---
npm install zustand  # or redux-toolkit

Package Details:

1. @microsoft/signalr
   - SignalR client for JavaScript/TypeScript
   - Used for WebSocket connections to game hubs
   - Version: Latest stable

2. axios
   - HTTP client for REST API calls
   - Alternative: native fetch API
   - Provides better error handling

3. zustand (optional)
   - Simple state management
   - Store player info, game state, lobby data

================================================================================
5. REST API ENDPOINTS REFERENCE
================================================================================

Base URL: https://localhost:7049/api

--------------------------------------------------------------------------------
5.1 PLAYER ENDPOINTS
--------------------------------------------------------------------------------

GET /api/player
  Description: Get all players (paginated)
  Query Params: ?limit=100 (optional)
  Response: List<PlayerDto>
  Example:
    GET https://localhost:7049/api/player?limit=50

POST /api/player
  Description: Create a new player
  Body: { "pseudo": "string" }
  Response: PlayerDto { id: Guid, pseudo: string }
  Example:
    POST https://localhost:7049/api/player
    Body: { "pseudo": "JohnDoe" }

GET /api/player/{id}
  Description: Get player by ID
  Path Params: id (Guid)
  Response: PlayerDto
  Example:
    GET https://localhost:7049/api/player/123e4567-e89b-12d3-a456-426614174000

DELETE /api/player/{id}
  Description: Delete player (GDPR compliance)
  Path Params: id (Guid)
  Response: 200 OK
  Example:
    DELETE https://localhost:7049/api/player/123e4567-e89b-12d3-a456-426614174000

--------------------------------------------------------------------------------
5.2 LOBBY ENDPOINTS
--------------------------------------------------------------------------------

GET /api/lobby
  Description: Get all public lobbies waiting for players
  Query Params: ?gameType=Morpion (optional)
  Response: List<LobbyDto>
  Game Types: "Morpion", "SpeedTyping", "Puissance4"
  Example:
    GET https://localhost:7049/api/lobby?gameType=Morpion

GET /api/lobby/{id}
  Description: Get lobby details
  Path Params: id (Guid)
  Query Params: ?playerId=<guid> (required)
  Response: LobbyDetailsDto
  Example:
    GET https://localhost:7049/api/lobby/abc-123?playerId=def-456

GET /api/lobby/{id}/players
  Description: Get all players in a lobby
  Path Params: id (Guid)
  Response: List<PlayerDto>
  Example:
    GET https://localhost:7049/api/lobby/abc-123/players

POST /api/lobby
  Description: Create a new lobby
  Body: CreateLobbyRequest
    {
      "playerId": "guid",
      "gameType": "string",
      "maxPlayers": int,
      "password": "string" (optional)
    }
  Response: { "lobbyId": "guid", "shareLink": "string" }
  Example:
    POST https://localhost:7049/api/lobby
    Body:
    {
      "playerId": "123e4567-e89b-12d3-a456-426614174000",
      "gameType": "Morpion",
      "maxPlayers": 2,
      "password": null
    }

POST /api/lobby/{id}/join
  Description: Join an existing lobby
  Path Params: id (Guid)
  Body: { "playerId": "guid", "password": "string" (optional) }
  Response: 200 OK
  Example:
    POST https://localhost:7049/api/lobby/abc-123/join
    Body: { "playerId": "def-456" }

POST /api/lobby/{id}/leave
  Description: Leave a lobby before game starts
  Path Params: id (Guid)
  Body: "guid" (playerId as raw JSON string)
  Response: 200 OK
  Note: If host leaves, lobby is deleted
  Example:
    POST https://localhost:7049/api/lobby/abc-123/leave
    Body: "123e4567-e89b-12d3-a456-426614174000"

POST /api/lobby/{id}/start
  Description: Start the game (host only)
  Path Params: id (Guid)
  Body: "guid" (hostId as raw JSON string)
  Response: { "gameSessionId": "guid" }
  Example:
    POST https://localhost:7049/api/lobby/abc-123/start
    Body: "123e4567-e89b-12d3-a456-426614174000"

DELETE /api/lobby/{id}
  Description: Delete lobby (host only)
  Path Params: id (Guid)
  Query Params: ?hostId=<guid>
  Response: 200 OK
  Example:
    DELETE https://localhost:7049/api/lobby/abc-123?hostId=def-456

--------------------------------------------------------------------------------
5.3 LEADERBOARD ENDPOINTS
--------------------------------------------------------------------------------

GET /api/leaderboard/{gameType}
  Description: Get leaderboard for a game type
  Path Params: gameType (Morpion|SpeedTyping|Puissance4)
  Query Params: ?top=10&playerId=<guid> (optional)
  Response: LeaderboardResponse
  Example:
    GET https://localhost:7049/api/leaderboard/Morpion?top=10

GET /api/leaderboard/games
  Description: Get statistics for all games
  Response: List<GameStatsDto>
  Example:
    GET https://localhost:7049/api/leaderboard/games

GET /api/leaderboard/player/{playerId}
  Description: Get player's game history
  Path Params: playerId (Guid)
  Query Params: ?gameType=Morpion (optional)
  Response: List<LeaderboardDto>
  Example:
    GET https://localhost:7049/api/leaderboard/player/abc-123?gameType=Morpion

POST /api/leaderboard
  Description: Add a score to leaderboard
  Body: AddScoreRequest
    {
      "playerId": "guid",
      "gameType": "string",
      "score": int,
      "gameSessionId": "guid"
    }
  Response: LeaderboardDto
  Example:
    POST https://localhost:7049/api/leaderboard
    Body:
    {
      "playerId": "123e4567-e89b-12d3-a456-426614174000",
      "gameType": "Morpion",
      "score": 100,
      "gameSessionId": "abc-123"
    }

DELETE /api/leaderboard/player/{playerId}
  Description: Delete all scores for a player (GDPR)
  Path Params: playerId (Guid)
  Response: { "deleted": int }
  Example:
    DELETE https://localhost:7049/api/leaderboard/player/abc-123

--------------------------------------------------------------------------------
5.4 ADMIN ENDPOINTS (Optional)
--------------------------------------------------------------------------------

GET /api/admin/game-history/{sessionId}
  Description: Get complete game history
  Path Params: sessionId (Guid)
  Response: GameHistoryResponse

GET /api/admin/game-sessions
  Description: Get all game sessions
  Query Params: ?gameType=Morpion&limit=50
  Response: List<GameSessionSummaryDto>

GET /api/admin/player-actions/{playerId}
  Description: Get all actions by a player
  Path Params: playerId (Guid)
  Query Params: ?gameSessionId=<guid> (optional)
  Response: List<GameActionDto>

GET /api/admin/export/{sessionId}
  Description: Export game session as JSON file
  Path Params: sessionId (Guid)
  Response: File download (application/json)

GET /api/admin/platform-stats
  Description: Get platform-wide statistics
  Response: PlatformStatsDto

DELETE /api/admin/game-history/{sessionId}
  Description: Delete game history (GDPR)
  Path Params: sessionId (Guid)
  Response: { "deleted": int }

================================================================================
6. SIGNALR WEBSOCKET INTEGRATION
================================================================================

--------------------------------------------------------------------------------
6.1 SETUP SIGNALR CONNECTION
--------------------------------------------------------------------------------

Basic connection setup:

--- app/lib/signalr.ts ---
import * as signalR from '@microsoft/signalr';

export function createHubConnection(hubPath: string) {
  const connection = new signalR.HubConnectionBuilder()
    .withUrl(`${process.env.NEXT_PUBLIC_WS_URL}${hubPath}`, {
      skipNegotiation: true,
      transport: signalR.HttpTransportType.WebSockets
    })
    .withAutomaticReconnect()
    .configureLogging(signalR.LogLevel.Information)
    .build();

  return connection;
}
--------------------------

Connection lifecycle:

1. Create connection
2. Register event handlers (.on())
3. Start connection (.start())
4. Invoke methods (.invoke())
5. Close connection (.stop())

--------------------------------------------------------------------------------
6.2 LOBBY HUB (/lobbyhub)
--------------------------------------------------------------------------------

Hub URL: wss://localhost:7049/lobbyhub

Methods to Invoke:
- JoinLobbyGroup(string lobbyId)
- LeaveLobbyGroup(string lobbyId)
- SubscribeToLobbyList()
- UnsubscribeFromLobbyList()

Events to Listen:
- LobbyCreated ? { LobbyDto }
- LobbyDeleted ? { lobbyId: string }
- PlayerJoined ? { PlayerDto }
- PlayerLeft ? { PlayerDto }
- GameStarted ? { gameType, gameSessionId, players }
- LobbyClosed ? { reason: string }

Example Usage:

const lobbyConnection = createHubConnection('/lobbyhub');

// Register event handlers
lobbyConnection.on('LobbyCreated', (lobby) => {
  console.log('New lobby:', lobby);
  // Update lobby list in state
});

lobbyConnection.on('PlayerJoined', (player) => {
  console.log('Player joined:', player);
  // Update player list
});

lobbyConnection.on('GameStarted', (data) => {
  console.log('Game starting:', data);
  // Navigate to game page
  router.push(`/game/${data.gameType}?session=${data.gameSessionId}`);
});

// Start connection
await lobbyConnection.start();

// Subscribe to lobby list updates
await lobbyConnection.invoke('SubscribeToLobbyList');

// Join a specific lobby's group
await lobbyConnection.invoke('JoinLobbyGroup', lobbyId);

// Cleanup
await lobbyConnection.invoke('LeaveLobbyGroup', lobbyId);
await lobbyConnection.stop();

--------------------------------------------------------------------------------
6.3 TIC-TAC-TOE HUB (/tictactoehub)
--------------------------------------------------------------------------------

Hub URL: wss://localhost:7049/tictactoehub

Methods to Invoke:
- JoinGameRoom(string lobbyId)
- LeaveGameRoom(string lobbyId)
- InitializeGame(string lobbyId, Guid gameSessionId, List<Guid> playerIds)
- MakeMove(string lobbyId, Guid gameSessionId, Guid playerId, int row, int col)
- GetGameState(Guid gameSessionId) ? Returns TicTacToeGameDto
- Forfeit(string lobbyId, Guid gameSessionId, Guid playerId)

Events to Listen:
- TicTacToeInitialized ? { gameState: TicTacToeGameDto }
- MoveMade ? { gameState: TicTacToeGameDto }
- GameOver ? { winner, gameState }
- InvalidMove ? { reason: string }
- GameError ? { error: string }
- PlayerForfeited ? { playerId, winnerId }

Example Usage:

const gameConnection = createHubConnection('/tictactoehub');

gameConnection.on('TicTacToeInitialized', (gameState) => {
  setBoard(gameState.board);
  setCurrentPlayer(gameState.currentPlayerId);
});

gameConnection.on('MoveMade', (gameState) => {
  setBoard(gameState.board);
  setCurrentPlayer(gameState.currentPlayerId);
});

gameConnection.on('GameOver', (result) => {
  console.log('Game over:', result);
  setGameOver(true);
  setWinner(result.winnerId);
  setBoard(result.gameState.board);
});

await gameConnection.start();
await gameConnection.invoke('JoinGameRoom', lobbyId);
await gameConnection.invoke('InitializeGame', lobbyId, gameSessionId, playerIds);

// When player clicks a cell
async function handleCellClick(row, col) {
  await gameConnection.invoke('MakeMove', lobbyId, gameSessionId, playerId, row, col);
}

--------------------------------------------------------------------------------
6.4 SPEED TYPING HUB (/speedtypinghub)
--------------------------------------------------------------------------------

Hub URL: wss://localhost:7049/speedtypinghub

Methods to Invoke:
- JoinGameRoom(string lobbyId)
- LeaveGameRoom(string lobbyId)
- InitializeGame(string lobbyId, Guid gameSessionId, List<Guid> playerIds)
- StartRace(string lobbyId, Guid gameSessionId)
- UpdateProgress(string lobbyId, Guid gameSessionId, Guid playerId, 
                 int charactersTyped, int errorCount)
- GetGameState(Guid gameSessionId) ? Returns SpeedTypingGameDto

Events to Listen:
- SpeedTypingInitialized ? { text, players }
- Countdown ? { count: int } (3, 2, 1)
- RaceStarted ? { startTime }
- ProgressUpdated ? { playerId, progress, errorCount }
- PlayerFinished ? { playerId, time, accuracy }
- RaceEnded ? { rankings }
- RaceTimeout ? { rankings }
- GameError ? { error: string }

Example Usage:

const typingConnection = createHubConnection('/speedtypinghub');

typingConnection.on('Countdown', (data) => {
  setCountdown(data.count);
});

typingConnection.on('RaceStarted', () => {
  setIsRacing(true);
  setStartTime(Date.now());
});

typingConnection.on('ProgressUpdated', (data) => {
  updatePlayerProgress(data.playerId, data.progress);
});

await typingConnection.start();
await typingConnection.invoke('JoinGameRoom', lobbyId);
await typingConnection.invoke('InitializeGame', lobbyId, gameSessionId, playerIds);
await typingConnection.invoke('StartRace', lobbyId, gameSessionId);

// On typing input change
function handleTyping(currentInput) {
  const typed = currentInput.length;
  const errors = calculateErrors(currentInput, targetText);
  
  typingConnection.invoke('UpdateProgress', 
    lobbyId, gameSessionId, playerId, typed, errors);
}

--------------------------------------------------------------------------------
6.5 CONNECT 4 HUB (/connect4hub)
--------------------------------------------------------------------------------

Hub URL: wss://localhost:7049/connect4hub

Methods to Invoke:
- JoinGameRoom(string lobbyId)
- LeaveGameRoom(string lobbyId)
- InitializeGame(string lobbyId, Guid gameSessionId, List<Guid> playerIds)
- DropPiece(string lobbyId, Guid gameSessionId, Guid playerId, int column)
- GetGameState(Guid gameSessionId) ? Returns Connect4GameDto
- Forfeit(string lobbyId, Guid gameSessionId, Guid playerId)

Events to Listen:
- Connect4Initialized ? { gameState: Connect4GameDto }
- PieceDropped ? { gameState: Connect4GameDto }
- GameOver ? { winner, gameState }
- InvalidMove ? { reason: string }
- GameError ? { error: string }
- PlayerForfeited ? { playerId, winnerId }

Example Usage:

const connect4Connection = createHubConnection('/connect4hub');

connect4Connection.on('Connect4Initialized', (gameState) => {
  setBoard(gameState.board); // 6 rows x 7 columns
  setCurrentPlayer(gameState.currentPlayerId);
});

connect4Connection.on('PieceDropped', (gameState) => {
  setBoard(gameState.board);
  setCurrentPlayer(gameState.currentPlayerId);
});

await connect4Connection.start();
await connect4Connection.invoke('JoinGameRoom', lobbyId);
await connect4Connection.invoke('InitializeGame', lobbyId, gameSessionId, playerIds);

// When player clicks a column
async function handleColumnClick(column) {
  await connect4Connection.invoke('DropPiece', 
    lobbyId, gameSessionId, playerId, column);
}

================================================================================
7. DATA MODELS (DTOs)
================================================================================

--------------------------------------------------------------------------------
7.1 PLAYER DTOS
--------------------------------------------------------------------------------

PlayerDto {
  id: string (Guid)
  pseudo: string
}

CreatePlayerRequest {
  pseudo: string
}

--------------------------------------------------------------------------------
7.2 LOBBY DTOS
--------------------------------------------------------------------------------

LobbyDto {
  id: string (Guid)
  gameType: string
  hostPseudo: string
  currentPlayers: number
  maxPlayers: number
  isPrivate: boolean
}

LobbyDetailsDto {
  id: string (Guid)
  gameType: string
  players: PlayerDto[]
  maxPlayers: number
  isHost: boolean
  status: string
}

CreateLobbyRequest {
  playerId: string (Guid)
  gameType: string
  maxPlayers: number
  password?: string
}

CreateLobbyResponse {
  lobbyId: string (Guid)
  shareLink: string
}

JoinLobbyRequest {
  playerId: string (Guid)
  password?: string
}

--------------------------------------------------------------------------------
7.3 GAME DTOS
--------------------------------------------------------------------------------

TicTacToeGameDto {
  gameSessionId: string (Guid)
  board: string[][] (3x3 jagged array, values: null | playerId)
  currentPlayerId: string (Guid)
  players: PlayerDto[]
  status: string
  winner?: string (Guid)
}

SpeedTypingGameDto {
  gameSessionId: string (Guid)
  text: string
  players: {
    playerId: string
    progress: number
    errorCount: number
    finished: boolean
  }[]
  status: string
  rankings: {
    playerId: string
    time: number
    accuracy: number
  }[]
}

Connect4GameDto {
  gameSessionId: string (Guid)
  board: int[][] (6x7 jagged array, values: 0 | 1 | 2)
  currentPlayerId: string (Guid)
  players: PlayerDto[]
  status: string
  winner?: string (Guid)
}

--------------------------------------------------------------------------------
7.4 LEADERBOARD DTOS
--------------------------------------------------------------------------------

LeaderboardDto {
  id: string (Guid)
  playerId: string (Guid)
  playerPseudo: string
  gameType: string
  score: number
  achievedAt: string (ISO date)
}

LeaderboardResponse {
  leaderboard: LeaderboardDto[]
  playerRank?: {
    rank: number
    score: number
  }
}

AddScoreRequest {
  playerId: string (Guid)
  gameType: string
  score: number
  gameSessionId: string (Guid)
}

GameStatsDto {
  gameType: string
  totalGames: number
  totalPlayers: number
  averageScore: number
}

================================================================================
8. COMPLETE IMPLEMENTATION EXAMPLES
================================================================================

--------------------------------------------------------------------------------
8.1 EXAMPLE: PLAYER CREATION
--------------------------------------------------------------------------------

--- app/components/PlayerSetup.tsx ---
'use client';
import { useState } from 'react';
import axios from 'axios';

const API_URL = process.env.NEXT_PUBLIC_API_URL;

export default function PlayerSetup({ onPlayerCreated }) {
  const [pseudo, setPseudo] = useState('');
  const [loading, setLoading] = useState(false);

  const handleCreatePlayer = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const response = await axios.post(`${API_URL}/api/player`, {
        pseudo: pseudo
      });

      const player = response.data;
      
      // Store player info in localStorage
      localStorage.setItem('playerId', player.id);
      localStorage.setItem('playerPseudo', player.pseudo);

      onPlayerCreated(player);
    } catch (error) {
      console.error('Error creating player:', error);
      alert('Failed to create player');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleCreatePlayer}>
      <input
        type="text"
        value={pseudo}
        onChange={(e) => setPseudo(e.target.value)}
        placeholder="Enter your pseudo"
        required
        minLength={3}
      />
      <button type="submit" disabled={loading}>
        {loading ? 'Creating...' : 'Create Player'}
      </button>
    </form>
  );
}
--------------------------------------

--------------------------------------------------------------------------------
8.2 EXAMPLE: LOBBY LIST WITH SIGNALR
--------------------------------------------------------------------------------

--- app/components/LobbyList.tsx ---
'use client';
import { useState, useEffect } from 'react';
import axios from 'axios';
import * as signalR from '@microsoft/signalr';

const API_URL = process.env.NEXT_PUBLIC_API_URL;
const WS_URL = process.env.NEXT_PUBLIC_WS_URL;

export default function LobbyList() {
  const [lobbies, setLobbies] = useState([]);
  const [connection, setConnection] = useState(null);

  useEffect(() => {
    // Fetch initial lobbies
    fetchLobbies();

    // Setup SignalR connection
    const hubConnection = new signalR.HubConnectionBuilder()
      .withUrl(`${WS_URL}/lobbyhub`)
      .withAutomaticReconnect()
      .build();

    // Register event handlers
    hubConnection.on('LobbyCreated', (lobby) => {
      setLobbies(prev => [...prev, lobby]);
    });

    hubConnection.on('LobbyDeleted', (lobbyId) => {
      setLobbies(prev => prev.filter(l => l.id !== lobbyId));
    });

    // Start connection and subscribe
    hubConnection.start()
      .then(() => {
        console.log('Connected to LobbyHub');
        hubConnection.invoke('SubscribeToLobbyList');
      })
      .catch(err => console.error('Error connecting:', err));

    setConnection(hubConnection);

    // Cleanup
    return () => {
      if (hubConnection) {
        hubConnection.invoke('UnsubscribeFromLobbyList');
        hubConnection.stop();
      }
    };
  }, []);

  const fetchLobbies = async () => {
    try {
      const response = await axios.get(`${API_URL}/api/lobby`);
      setLobbies(response.data);
    } catch (error) {
      console.error('Error fetching lobbies:', error);
    }
  };

  const handleJoinLobby = async (lobbyId) => {
    const playerId = localStorage.getItem('playerId');
    
    try {
      await axios.post(`${API_URL}/api/lobby/${lobbyId}/join`, {
        playerId: playerId
      });
      
      // Navigate to lobby page
      window.location.href = `/lobby/${lobbyId}`;
    } catch (error) {
      console.error('Error joining lobby:', error);
      alert(error.response?.data || 'Failed to join lobby');
    }
  };

  return (
    <div>
      <h2>Available Lobbies</h2>
      {lobbies.length === 0 ? (
        <p>No lobbies available</p>
      ) : (
        <ul>
          {lobbies.map(lobby => (
            <li key={lobby.id}>
              <strong>{lobby.gameType}</strong> - 
              Host: {lobby.hostPseudo} - 
              Players: {lobby.currentPlayers}/{lobby.maxPlayers}
              {lobby.isPrivate && ' ??'}
              <button onClick={() => handleJoinLobby(lobby.id)}>
                Join
              </button>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}
-------------------------------------

--------------------------------------------------------------------------------
8.3 EXAMPLE: CREATE LOBBY
--------------------------------------------------------------------------------

--- app/components/CreateLobby.tsx ---
'use client';
import { useState } from 'react';
import axios from 'axios';
import { useRouter } from 'next/navigation';

const API_URL = process.env.NEXT_PUBLIC_API_URL;

export default function CreateLobby() {
  const [gameType, setGameType] = useState('Morpion');
  const [maxPlayers, setMaxPlayers] = useState(2);
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleCreateLobby = async (e) => {
    e.preventDefault();
    setLoading(true);

    const playerId = localStorage.getItem('playerId');
    
    if (!playerId) {
      alert('Please create a player first');
      return;
    }

    try {
      const response = await axios.post(`${API_URL}/api/lobby`, {
        playerId: playerId,
        gameType: gameType,
        maxPlayers: maxPlayers,
        password: password || null
      });

      const { lobbyId } = response.data;
      router.push(`/lobby/${lobbyId}`);
    } catch (error) {
      console.error('Error creating lobby:', error);
      alert('Failed to create lobby');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleCreateLobby}>
      <label>
        Game Type:
        <select value={gameType} onChange={(e) => setGameType(e.target.value)}>
          <option value="Morpion">Tic-Tac-Toe</option>
          <option value="SpeedTyping">Speed Typing</option>
          <option value="Puissance4">Connect 4</option>
        </select>
      </label>

      <label>
        Max Players:
        <input
          type="number"
          value={maxPlayers}
          onChange={(e) => setMaxPlayers(parseInt(e.target.value))}
          min="2"
          max="10"
        />
      </label>

      <label>
        Password (optional):
        <input
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          placeholder="Leave empty for public"
        />
      </label>

      <button type="submit" disabled={loading}>
        {loading ? 'Creating...' : 'Create Lobby'}
      </button>
    </form>
  );
}
--------------------------------------

--------------------------------------------------------------------------------
8.4 EXAMPLE: TIC-TAC-TOE GAME
--------------------------------------------------------------------------------

--- app/game/tictactoe/page.tsx ---
'use client';
import { useState, useEffect } from 'react';
import { useSearchParams } from 'next/navigation';
import * as signalR from '@microsoft/signalr';

const WS_URL = process.env.NEXT_PUBLIC_WS_URL;

export default function TicTacToePage() {
  const searchParams = useSearchParams();
  const sessionId = searchParams.get('session');
  const lobbyId = searchParams.get('lobby');

  const [board, setBoard] = useState(Array(3).fill(null).map(() => Array(3).fill(null)));
  const [currentPlayer, setCurrentPlayer] = useState(null);
  const [connection, setConnection] = useState(null);
  const [gameOver, setGameOver] = useState(false);
  const [winner, setWinner] = useState(null);

  const playerId = typeof window !== 'undefined' 
    ? localStorage.getItem('playerId') 
    : null;

  useEffect(() => {
    if (!sessionId || !lobbyId) return;

    const hubConnection = new signalR.HubConnectionBuilder()
      .withUrl(`${WS_URL}/tictactoehub`)
      .withAutomaticReconnect()
      .build();

    // Register event handlers
    hubConnection.on('TicTacToeInitialized', (gameState) => {
      console.log('Game initialized:', gameState);
      setBoard(gameState.board);
      setCurrentPlayer(gameState.currentPlayerId);
    });

    hubConnection.on('MoveMade', (gameState) => {
      console.log('Move made:', gameState);
      setBoard(gameState.board);
      setCurrentPlayer(gameState.currentPlayerId);
    });

    hubConnection.on('GameOver', (result) => {
      console.log('Game over:', result);
      setGameOver(true);
      setWinner(result.winnerId);
      setBoard(result.gameState.board);
    });

    hubConnection.on('InvalidMove', (data) => {
      alert(`Invalid move: ${data.reason}`);
    });

    // Start connection
    hubConnection.start()
      .then(() => {
        console.log('Connected to TicTacToeHub');
        return hubConnection.invoke('JoinGameRoom', lobbyId);
      })
      .then(() => {
        // Game should already be initialized by host via LobbyHub
        return hubConnection.invoke('GetGameState', sessionId);
      })
      .then((gameState) => {
        if (gameState) {
          setBoard(gameState.board);
          setCurrentPlayer(gameState.currentPlayerId);
        }
      })
      .catch(err => console.error('Error:', err));

    setConnection(hubConnection);

    return () => {
      if (hubConnection) {
        hubConnection.invoke('LeaveGameRoom', lobbyId);
        hubConnection.stop();
      }
    };
  }, [sessionId, lobbyId]);

  const handleCellClick = async (row, col) => {
    if (gameOver || !connection) return;
    if (currentPlayer !== playerId) {
      alert('Not your turn!');
      return;
    }
    if
